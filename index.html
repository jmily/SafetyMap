<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Safety Map</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="css/custom-select.css" />
    <link href="css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
</head>
<body>
 <div class="container">
      <h1>Melbourne Road Safety Portal</h1>
     <div id="summary">
         Australia has achieved substantial reductions in road crash fatalities over the last 30 years, despite a 50 per cent growth in population and a two-fold increase in registered motor vehicles. Between 1980 and 2010, the nation’s annual road fatality rate declined from 22.3 to 6.1 deaths per 100,000 people. However, it is still estimated that on average, around 1,400 people die and 33,000 are seriously injured each year on Australian roads. The Australian Bureau of Infrastructure, Transport and Regional Economics (BITRE) estimated that the annual cost of road trauma to the Australian society is 17.85 billion AUD.
         <br><br>In this project, we visualize crash data in Melbourne at the Statistical Area Level 2 (SA2), defined by the Australian Bureau of Statistics. We obtained the crash data from VicRoads between the years for 2010 to 2012. During this period, a total of 12,206 crashes were reported.  Total number of crashes were decreasing from 2010 to 2012.
     </div>

     <!--Dropdown-->
     <div class="wrapper-demo">
         <div id="dd" class="wrapper-dropdown-3" tabindex="1000000">
             <span>Total Population</span>
             <ul class="dropdown" style="z-index:900099999999;">
                 <li id="total-p"><a href="#"><i class="fa fa-user icon-large"></i>Total Population</a></li>
                 <li id="density-p"><a href="#"><i class="fa fa-users icon-large"></i>Total Population Density</a></li>
                 <li id="vehicle-p"><a href="#"><i class="fa fa-car icon-large"></i>Vehicle Kilometers Travelled (million)</a></li>
                 <li id="crash-p"><a href="#"><i class="fa fa-exclamation-triangle icon-large"></i>Total Crashes</a></li>
                 <li id="crash-4-p"><a href="#"><i class="fa fa-exclamation-triangle icon-large"></i>Crashes in which a 4-16 year old involved</a></li>
                 <li id="crash-60-p"><a href="#"><i class="fa fa-exclamation-triangle icon-large"></i>Crashes in which a 60+ year old involved</a></li>
                 <li id="bike-p"><a href="#"><i class="icon-plane icon-large"></i>Bicycle Crashes</a></li>
                 <li id="pedestrian-p"><a href="#"><i class="fa fa-exclamation-triangle icon-large"></i>Pedestrian Crashes</a></li>
                 <li id="motor-p"><a href="#"><i class="fa fa-motorcycle icon-large"></i>Motorbike Crashes</a></li>
                 <li id="truck-p"><a href="#"><i class="fa fa-truck icon-large"></i>Truck Crashes</a></li>
                 <li id="fatal-p"><a href="#"><i class="fa fa-exclamation-triangle icon-large"></i>Fatal Crashes</a></li>
                 <li id="severe-p"><a href="#"><i class="fa fa-exclamation-triangle icon-large"></i>Severe Injury Crashes</a></li>
                 <li id="night-p"><a href="#"><i class="fa fa-exclamation-triangle icon-large"></i>Nighttime Crashes</a></li>
                 <li id="weekday-p"><a href="#"><i class="fa fa-exclamation-triangle icon-large"></i>Weekday Crashes</a></li>
                 <li id="weekend-p"> <a href="#"><i class="fa fa-exclamation-triangle icon-large"></i>Weekend Crashes</a></li>
             </ul>
         </div>
     ​</div>
     <!--End of dropdown-->



     <!-- Chart -->
     <div class="chart-container">
         <div class="rank-chart" id="rank-chart"></div>
         <div class="his-chart" id="his-chart"></div>
     </div>

     <!--End of chart-->

     <!-- Map-->
 <div id="map"></div>
     <div class="leaflet-control-container">
        <div class="leaflet-top leaflet-left">
          <div class="leaflet-control-zoom leaflet-bar leaflet-control">
             <div id="zoom-in" class="zoom-btn leaflet-control-zoom-in">+</div>
             <div id="zoom-out" class="zoom-btn leaflet-control-zoom-out">-</div>
          </div>
        </div>
     </div>
     <!--End of Map-->


 <div class="prediction">
     <h3 style="text-align: center">Predicting Crashes</h3>
   <div class="col-md-6 col-md-push-3">
     <form class="form-horizontal">
         <div class="form-group">
             <label for="vktInput">Average VKT</label><span class="msg" id="vktmsg"></span>
             <input type="text" class="form-control input-sm" id="vktInput" placeholder="e.g. 10988778">
         </div>
         <div class="form-group">
             <label for="weeklyIncome">Percentage of Household with Weekly Income</label><span id="weeklymsg" class="msg"></span>
             <input type="text" class="form-control input-sm" id="weeklyIncome" placeholder="e.g. 2" aria-describedby="weeklyaddon">
         </div>
         <div class="form-group">
             <label for="bikePopulation">Percentage of Population that Bike to Work</label><span id="bikemsg" class="msg"></span>
             <input type="text" class="form-control input-sm" id="bikePopulation" placeholder="e.g. 2">
         </div>
         <div class="form-group">
             <label for="residential">Percentage of Residential Area</label><span id="residentmsg" class="msg"></span>
             <input type="text" class="form-control input-sm" id="residential" placeholder="e.g. 2">
         </div>
         <div class="form-group">
             <label for="commercial">Percentage of Commercial Area</label><span id="commercialmsg" class="msg"></span>
             <input type="text" class="form-control input-sm" id="commercial" placeholder="e.g. 2">
         </div>
         <div class="form-group">
             <label for="mixIndex">Land-use Balance Mix Index </label><span id="mixmsg" class="msg"></span>
             <input type="text" class="form-control input-sm" id="mixIndex" placeholder="e.g. 2">
         </div>
         <div class="form-group">
           <span id="predict" style="margin-left:45%;" class="btn btn-default">Predict</span>
         </div>
     </form>
       </div>
     <div class="col-xs-12" >
         <h1 id="result"><b>Result</b></h1>
     </div>
 </div>



 </div>


 <div id="tooltip">
     <div id="title"></div>
     <div id="content"></div>
 </div>


 <!-- third party library -->
 <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
 <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
 <script src="js/lib/leaflet.js"></script>
 <script src="js/lib/modernizr.custom.79639.js"></script>
 <script src="js/lib/amcharts.js"></script>
 <script src="js/lib/serial.js"></script>
 <script src="js/lib/d3.min.js"></script>
 <script src="js/lib/topojson.min.js"></script>
<!-- end of third party library -->



 <script src="js/map.js"></script>
 <script src="js/chart.js"></script>
 <script src="js/prediction.js"></script>

 <script>
     function numberWithCommas(x) {
         return x.toString().replace(/\B(?=(?:\d{3})+(?!\d))/g, ",");
     }
     $(document).ready(function()
     {

         makeHistogramChart('his-chart',populationFre,'Total Population');
         makeRankChart('rank-chart',populationRank,'Total Population');

         $('body').on('click','#predict',function()
         {

             $('#vktmsg').text('');
             $('#weeklymsg').text('');
             $('#bikemsg').text('');
             $('#residentmsg').text('');
             $('#commercialmsg').text('');
             $('#mixmsg').text('');
             var vktInput = parseFloat($('#vktInput').val());
             var weeklyIncome = parseFloat($('#weeklyIncome').val());
             var bikeInput = parseFloat($('#bikePopulation').val());
             var residentialInput = parseFloat($('#residential').val());
             var commercialInput = parseFloat($('#commercial').val());
             var mixIndex = parseFloat($('#mixIndex').val());

             var valid = true;

             if(!$.isNumeric(vktInput))
             {
                 valid =false;
                 $('#vktmsg').text('invalid number');
             }
             if(!$.isNumeric(weeklyIncome))
             {
                 valid =false;
                 $('#weeklymsg').text('invalid number');
             }
             if(!$.isNumeric(bikeInput))
             {
                 valid =false;
                 $('#bikemsg').text('invalid number');
             }
             if(!$.isNumeric(residentialInput))
             {
                 valid =false;
                 $('#residentmsg').text('invalid number');
             }
             if(!$.isNumeric(commercialInput))
             {
                 valid =false;
                 $('#commercialmsg').text('invalid number');
             }
             if(!$.isNumeric(mixIndex))
             {
                 valid =false;
                 $('#mixmsg').text('invalid number');
             }

             if(valid)
             {
                 var result = 1.563 + 0.328 * Math.log(vktInput) + 0.012 * weeklyIncome + 0.036 * bikeInput + 0.013 * residentialInput + 0.009 * commercialInput + 0.732 * mixIndex;
                 result = Math.round(result);
                 result = numberWithCommas(result);

                 $('#result').text('Result');
                 $('#result').append(': '+result+ ' crashes in the zone');
             }


         });

//         $('button').hover(function(){
//             if($(this).attr('class')!= 'btn-clicked') {
//                 $(this).removeClass("btn");
//                 $(this).removeClass("btn-clicked").addClass("btn-active");
//             }
//
//         }, function()
//         {
//             if($(this).attr('class')!= 'btn-clicked') {
//
//                 $(this).removeClass("btn-active").addClass("btn");
//             }
//         });
//
//
//         $('button').click(function(){
//             $('.btn-clicked').each(function()
//             {
//                 $(this).removeClass("btn-clicked").addClass("btn");
//
//             });
//             $(this).removeClass("btn");
//             $(this).removeClass("btn-active").addClass("btn-clicked");
//
//         });
         $("#tooltip").hide();
     });
 </script>

 <script type="text/javascript">

     function DropDown(el) {
         this.dd = el;
         this.placeholder = this.dd.children('span');
         this.opts = this.dd.find('ul.dropdown > li');
         this.val = '';
         this.index = -1;
         this.initEvents();
     }
     DropDown.prototype = {
         initEvents : function() {
             var obj = this;

             obj.dd.on('click', function(event){
                 $(this).toggleClass('active');
                 return false;
             });

             obj.opts.on('click',function(){
                 var opt = $(this);
                 obj.val = opt.text();
                 obj.index = opt.index();
                 obj.placeholder.text(obj.val);
             });
         },
         getValue : function() {
             return this.val;
         },
         getIndex : function() {
             return this.index;
         }
     }

     $(function() {

         var dd = new DropDown( $('#dd') );

         $(document).click(function() {
             // all dropdowns
             $('.wrapper-dropdown-3').removeClass('active');
         });

     });

 </script>

</body>
</html>